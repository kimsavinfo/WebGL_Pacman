<!DOCTYPE html>
<html>
<head>
	<title>WebGL - Pacman</title>
	<meta charset="UTF-8" />
	
	<script type="text/javascript" src="libs/three.js"></script>
	<script type="text/javascript" src="libs/stats.js"></script>
	<script type="text/javascript" src="libs/dat.gui.js"></script>
	<script type="text/javascript" src="libs/d3-threeD.js"></script>
	<script type="text/javascript" src="libs/OrbitControls.js"></script>
	<style>
		body {
			/* set margin to 0 and overflow to hidden, to go fullscreen */
			margin: 0;
			overflow: hidden;
		}
		
	</style>
</head>
<body>


<!-- Div which will hold the Output -->
<div id="WebGL-output">
</div>

<script type="text/javascript">

var camera, renderer;

function init() {
	var stats = initStats();
	
	var scene = new THREE.Scene();
	
	// create a render and set the size
	renderer = new THREE.WebGLRenderer();
	renderer.setClearColor(new THREE.Color(0x333333, 1.0));
	renderer.setSize(window.innerWidth, window.innerHeight);
	renderer.shadowMapEnabled = true;
	
	// ====================================== AXES ======================================
	var axes = new THREE.AxisHelper(200);
	axes.visible = true;
	scene.add(axes);
	
	// ====================================== SPOTLIGHT ======================================
	
	var spotLight = new THREE.SpotLight(0xffffff);
	spotLight.position.set(0, 60, 0);
	spotLight.castShadow = true;
	scene.add(spotLight);
	
	// ====================================== CAMERA ======================================
	
	camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
	camera.position.set(0, 40, 200);
	camera.lookAt(scene.position);
	
	document.getElementById("WebGL-output").appendChild(renderer.domElement);
	
	render();
	
	function render() {
		stats.update();
		
		var time = Date.now() * 0.0005;
		
		
		
		requestAnimationFrame(render);
		renderer.render(scene, camera);
	}

	function initStats() {
		var stats = new Stats();
		stats.setMode(0); // 0: fps, 1: ms
		
		// Put the stats in the top-left corner
		stats.domElement.style.position = 'absolute';
		stats.domElement.style.left = '0px';
		stats.domElement.style.top = '0px';
		document.getElementById("WebGL-output").appendChild(stats.domElement);
		
		return stats;
	}
}

window.onload = init;

// ====================================== RESIZE ======================================

window.addEventListener('resize', onResize, false);
function onResize() {
	camera.aspect = window.innerWidth / window.innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize(window.innerWidth, window.innerHeight);
}

// ====================================== SCROLL AND ZOOM ======================================

window.addEventListener('DOMMouseScroll', mousewheel, false);
window.addEventListener('mousewheel', mousewheel, false);
function mousewheel(event) 
{
	var delta = 0;
	if (!event) /* For IE. */
			event = window.event;
	if (event.wheelDelta) { /* IE/Opera. */
			delta = event.wheelDelta/120;
	} else if (event.detail) { /** Mozilla case. */
			/** In Mozilla, sign of delta is different than in IE.
			 * Also, delta is multiple of 3.
			 */
			delta = -event.detail/3;
	}
	/** If delta is nonzero, handle it.
	 * Basically, delta is now positive if wheel was scrolled up,
	 * and negative, if wheel was scrolled down.
	 */
	if (delta)
			handle(delta);
	/** Prevent default actions caused by mouse wheel. */
	if (event.preventDefault)
			event.preventDefault();
	
	event.returnValue = false;
}

function handle(delta) {
	var zoom = 10;
	
	var fovMax = 60;
	var fovMin = 20;
	
	if (delta < 0 && camera.fov < fovMax)
	{
		camera.fov += zoom;
	}
	if(delta > 0 && camera.fov > fovMin )
	{
		camera.fov -= zoom;
	}
	
	camera.updateProjectionMatrix();
}

</script>
</body>
</html>